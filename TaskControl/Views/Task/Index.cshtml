@model TaskControl.Models.TaskViewModel
@using TaskControl.Models
@{
    ViewData["Title"] = "Index";
}


<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
</head>
<body>

    <h1>Index</h1>



    <p>
        <a asp-action="Create">+</a>
    </p>

    <div id="div-jstree">

    </div>





    <script>
        $('#div-jstree').jstree(
            {
            'core': {
                'data' : @Html.Raw(ViewBag.Json),
                },


            }
        );

        $('#div-jstree').on('select_node.jstree', function (e, data) {
            var i, j, r = [];
            var selectID;
            for (i = 0, j = data.selected.length; i < j; i++) {
                r.push(data.instance.get_node(data.selected[i]).text);
                selectID = data.instance.get_node(data.selected[i])["id"];
            }
            console.log(selectID);
            var model = { ID: selectID, };
            $.ajax({
                type: "POST",
                url: "Home/Details",
                data: model,
                datatype: "json",
                success: function (Data) {
                    console.log("Passed data to controller");
                    alert(data.id);
                }
            });

        }).jstree();

    </script>



    <table class="table">

        <thead>
            <tr>
                <th>
                    ID
                </th>
                <th>
                    Имя
                </th>
                <th>
                    Описание
                </th>
                <th>
                    Исполнители
                </th>
                <th>
                    Создана
                </th>
                <th>
                    Статус
                </th>
                <th>
                    Предполагаемая дата окончания
                </th>
                <th>
                    IDРодителя
                </th>
                <th>
                    Ожидаемое время исполнения
                </th>
                <th>
                    Фактическое время исполнения
                </th>
                <th>
                    Действия
                </th>
                <th></th>
            </tr>
        </thead>

        <tbody>

            @foreach (var item in Model.Tasks)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.ID)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TaskName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Description)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TaskExecutors)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.RegistrationDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.taskStatus)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EstimatedEndDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ParentID)
                    </td>
                    <td>
                        @{
                            TimeSpan estimatedCompletionTime = item.EstimatedEndDate - item.RegistrationDate;
                            var timeToDisplay = estimatedCompletionTime.ToString(@"hh\:mm\:ss");
                            @timeToDisplay

                        }
                    </td>
                    <td>
                        @if (item.taskStatus == TaskControl.Models.TaskStatus.Complete)
                        {
                            TimeSpan completionTime = item.EndDate - item.RegistrationDate;
                            @completionTime.ToString(@"hh\:mm\:ss")
                        }
                    </td>
                    <td>
                        @foreach (var link in TaskControl.Models.TaskModelUtils.navLinks[item.taskStatus])
                        {
                            @Html.ActionLink(link.LinkText, link.ActionName, new { id = item.ID })
                            <a> </a>
                        };
                    </td>
                </tr>
            }
        </tbody>



    </table>
</body>

@section LeftBar {
    Все права защищены. Site Corp. 2016. 111
}